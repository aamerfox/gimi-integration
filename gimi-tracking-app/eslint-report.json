[{"filePath":"C:\\Users\\aamer\\Desktop\\SaudiEx project agents\\gimi integrartion\\gimi-tracking-app\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aamer\\Desktop\\SaudiEx project agents\\gimi integrartion\\gimi-tracking-app\\src\\components\\DevicePanel.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[516,519],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[516,519],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":65,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2522,2525],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2522,2525],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\r\nimport { useDeviceStore } from '../store/devices';\r\nimport type { Device } from '../store/devices';\r\n\r\nexport default function DevicePanel() {\r\n    const { devices, selectedDevice, selectDevice } = useDeviceStore();\r\n    const [search, setSearch] = useState('');\r\n\r\n    const filteredDevices = devices.filter((d: Device) =>\r\n        d.deviceName.toLowerCase().includes(search.toLowerCase()) ||\r\n        d.imei.includes(search)\r\n    );\r\n\r\n    const onlineCount = devices.filter((d: any) => d.status === '1' || d.posType === 'GPS').length;\r\n\r\n    return (\r\n        <div\r\n            className=\"glass-panel\"\r\n            style={{\r\n                height: '100%',\r\n                display: 'flex',\r\n                flexDirection: 'column',\r\n                overflow: 'hidden',\r\n            }}\r\n        >\r\n            {/* Header */}\r\n            <div style={{\r\n                padding: '16px',\r\n                borderBottom: '1px solid var(--border)',\r\n                flexShrink: 0,\r\n            }}>\r\n                <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '12px' }}>\r\n                    <h2 style={{ fontSize: '15px', fontWeight: 600 }}>Devices</h2>\r\n                    <div style={{ display: 'flex', gap: '8px' }}>\r\n                        <span className=\"badge badge-online\">{onlineCount}</span>\r\n                        <span className=\"badge badge-offline\">{devices.length - onlineCount}</span>\r\n                    </div>\r\n                </div>\r\n                <input\r\n                    type=\"text\"\r\n                    value={search}\r\n                    onChange={(e) => setSearch(e.target.value)}\r\n                    className=\"sx-input\"\r\n                    placeholder=\"Search devices...\"\r\n                    style={{ fontSize: '13px', padding: '8px 12px' }}\r\n                />\r\n            </div>\r\n\r\n            {/* Device List */}\r\n            <div style={{\r\n                flex: 1,\r\n                overflowY: 'auto',\r\n                padding: '8px',\r\n            }}>\r\n                {filteredDevices.length === 0 ? (\r\n                    <div style={{\r\n                        padding: '20px',\r\n                        textAlign: 'center',\r\n                        color: 'var(--text-muted)',\r\n                        fontSize: '13px',\r\n                    }}>\r\n                        No devices found\r\n                    </div>\r\n                ) : (\r\n                    filteredDevices.map((device: any) => {\r\n                        const isOnline = device.status === '1' || device.posType === 'GPS';\r\n                        const isSelected = selectedDevice?.imei === device.imei;\r\n                        const batteryVal = parseFloat(device.batteryPowerVal || device.battery || '0');\r\n                        const batteryClass = batteryVal > 50 ? '--battery' : batteryVal > 20 ? '--battery-mid' : '--battery-low';\r\n\r\n                        return (\r\n                            <button\r\n                                key={device.imei}\r\n                                onClick={() => selectDevice(isSelected ? null : device)}\r\n                                style={{\r\n                                    display: 'block',\r\n                                    width: '100%',\r\n                                    padding: '12px',\r\n                                    borderRadius: 'var(--radius-md)',\r\n                                    border: isSelected ? '1px solid var(--border-accent)' : '1px solid transparent',\r\n                                    background: isSelected ? 'var(--accent-dim)' : 'transparent',\r\n                                    textAlign: 'left',\r\n                                    cursor: 'pointer',\r\n                                    fontFamily: 'inherit',\r\n                                    color: 'inherit',\r\n                                    transition: 'all 0.15s ease',\r\n                                    marginBottom: '4px',\r\n                                }}\r\n                                onMouseEnter={(e) => {\r\n                                    if (!isSelected) e.currentTarget.style.background = 'rgba(255,255,255,0.03)';\r\n                                }}\r\n                                onMouseLeave={(e) => {\r\n                                    if (!isSelected) e.currentTarget.style.background = 'transparent';\r\n                                }}\r\n                            >\r\n                                <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>\r\n                                    {/* Status indicator */}\r\n                                    <div style={{\r\n                                        width: 36,\r\n                                        height: 36,\r\n                                        borderRadius: '10px',\r\n                                        background: isOnline ? 'rgba(34,197,94,0.1)' : 'rgba(107,114,128,0.1)',\r\n                                        display: 'flex',\r\n                                        alignItems: 'center',\r\n                                        justifyContent: 'center',\r\n                                        flexShrink: 0,\r\n                                    }}>\r\n                                        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke={isOnline ? 'var(--online)' : 'var(--offline)'} strokeWidth=\"2\">\r\n                                            <circle cx=\"12\" cy=\"10\" r=\"3\" /><path d=\"M12 2a8 8 0 0 0-8 8c0 5.4 7 11.5 7.3 11.8a1 1 0 0 0 1.4 0C13 21.5 20 15.4 20 10a8 8 0 0 0-8-8z\" />\r\n                                        </svg>\r\n                                    </div>\r\n\r\n                                    <div style={{ flex: 1, minWidth: 0 }}>\r\n                                        <div style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>\r\n                                            <span style={{ fontSize: '13px', fontWeight: 600, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>\r\n                                                {device.deviceName}\r\n                                            </span>\r\n                                            <span className={`status-dot ${isOnline ? 'status-dot--online' : 'status-dot--offline'}`} />\r\n                                        </div>\r\n                                        <div style={{ fontSize: '11px', color: 'var(--text-muted)', marginTop: '2px' }}>\r\n                                            {device.imei}\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Battery & Speed row */}\r\n                                <div style={{\r\n                                    display: 'flex',\r\n                                    alignItems: 'center',\r\n                                    gap: '12px',\r\n                                    marginTop: '8px',\r\n                                    marginLeft: '46px',\r\n                                }}>\r\n                                    {/* Battery */}\r\n                                    {batteryVal > 0 && (\r\n                                        <div style={{ flex: 1 }}>\r\n                                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '3px' }}>\r\n                                                <span style={{ fontSize: '10px', color: 'var(--text-muted)' }}>Battery</span>\r\n                                                <span style={{ fontSize: '10px', color: 'var(--text-secondary)' }}>{batteryVal}%</span>\r\n                                            </div>\r\n                                            <div className=\"progress-bar\">\r\n                                                <div className={`progress-bar__fill progress-bar__fill${batteryClass}`} style={{ width: `${batteryVal}%` }} />\r\n                                            </div>\r\n                                        </div>\r\n                                    )}\r\n                                    {/* Speed */}\r\n                                    {device.speed != null && (\r\n                                        <span style={{ fontSize: '11px', color: 'var(--text-muted)', whiteSpace: 'nowrap' }}>\r\n                                            {device.speed} km/h\r\n                                        </span>\r\n                                    )}\r\n                                </div>\r\n\r\n                                {/* GPS time */}\r\n                                {device.gpsTime && (\r\n                                    <div style={{ marginTop: '4px', marginLeft: '46px', fontSize: '10px', color: 'var(--text-muted)' }}>\r\n                                        Last: {device.gpsTime}\r\n                                    </div>\r\n                                )}\r\n                            </button>\r\n                        );\r\n                    })\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aamer\\Desktop\\SaudiEx project agents\\gimi integrartion\\gimi-tracking-app\\src\\components\\LiveMap.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Device' is defined but never used.","line":5,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":21,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Device"},"fix":{"range":[167,216],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":80,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3020,3023],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3020,3023],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":99,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3607,3610],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3607,3610],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":136,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5692,5695],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5692,5695],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useRef, useMemo } from 'react';\r\nimport L from 'leaflet';\r\nimport 'leaflet/dist/leaflet.css';\r\nimport { useDeviceStore } from '../store/devices';\r\nimport type { Device } from '../store/devices';\r\n\r\n// OpenStreetMap dark tile layer\r\nconst TILE_URL = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';\r\nconst TILE_ATTR = '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors';\r\n\r\nfunction createMarkerIcon(isOnline: boolean, isSelected: boolean) {\r\n    const size = isSelected ? 40 : 32;\r\n    const color = isOnline ? '#00d4aa' : '#6b7280';\r\n    const glowColor = isOnline ? 'rgba(0,212,170,0.3)' : 'rgba(107,114,128,0.2)';\r\n    const pulse = isOnline ? `animation: pulse-glow 2s ease-in-out infinite;` : '';\r\n\r\n    return L.divIcon({\r\n        className: '',\r\n        iconSize: [size, size],\r\n        iconAnchor: [size / 2, size / 2],\r\n        popupAnchor: [0, -size / 2],\r\n        html: `\r\n            <div style=\"\r\n                width: ${size}px;\r\n                height: ${size}px;\r\n                display: flex;\r\n                align-items: center;\r\n                justify-content: center;\r\n            \">\r\n                <div style=\"\r\n                    width: ${size - 4}px;\r\n                    height: ${size - 4}px;\r\n                    border-radius: 50%;\r\n                    background: ${glowColor};\r\n                    border: 2px solid ${color};\r\n                    display: flex;\r\n                    align-items: center;\r\n                    justify-content: center;\r\n                    ${pulse}\r\n                    ${isSelected ? `box-shadow: 0 0 20px ${glowColor};` : ''}\r\n                \">\r\n                    <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"${color}\" stroke=\"none\">\r\n                        <path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z\"/>\r\n                    </svg>\r\n                </div>\r\n            </div>\r\n        `,\r\n    });\r\n}\r\n\r\nexport default function LiveMap() {\r\n    const mapRef = useRef<L.Map | null>(null);\r\n    const containerRef = useRef<HTMLDivElement>(null);\r\n    const markersRef = useRef<Map<string, L.Marker>>(new Map());\r\n\r\n    const { devices, selectedDevice, selectDevice } = useDeviceStore();\r\n\r\n    // Initialize map\r\n    useEffect(() => {\r\n        if (!containerRef.current || mapRef.current) return;\r\n\r\n        const map = L.map(containerRef.current, {\r\n            center: [24.7136, 46.6753], // Riyadh\r\n            zoom: 6,\r\n            zoomControl: true,\r\n            attributionControl: true,\r\n        });\r\n\r\n        L.tileLayer(TILE_URL, { attribution: TILE_ATTR, maxZoom: 18 }).addTo(map);\r\n        mapRef.current = map;\r\n\r\n        return () => {\r\n            map.remove();\r\n            mapRef.current = null;\r\n        };\r\n    }, []);\r\n\r\n    // Filter devices with position data\r\n    const devicesWithLocation = useMemo(() =>\r\n        devices.filter((d: any) => d.lat && d.lng),\r\n        [devices]);\r\n\r\n    // Update markers\r\n    useEffect(() => {\r\n        const map = mapRef.current;\r\n        if (!map) return;\r\n\r\n        const currentImeis = new Set(devicesWithLocation.map(d => d.imei));\r\n\r\n        // Remove markers for devices no longer present\r\n        markersRef.current.forEach((marker, imei) => {\r\n            if (!currentImeis.has(imei)) {\r\n                marker.remove();\r\n                markersRef.current.delete(imei);\r\n            }\r\n        });\r\n\r\n        // Add/update markers\r\n        devicesWithLocation.forEach((device: any) => {\r\n            const isOnline = device.status === '1' || device.posType === 'GPS';\r\n            const isSelected = selectedDevice?.imei === device.imei;\r\n            const icon = createMarkerIcon(isOnline, isSelected);\r\n            const position: L.LatLngExpression = [device.lat, device.lng];\r\n\r\n            const existing = markersRef.current.get(device.imei);\r\n            if (existing) {\r\n                existing.setLatLng(position);\r\n                existing.setIcon(icon);\r\n            } else {\r\n                const marker = L.marker(position, { icon })\r\n                    .addTo(map)\r\n                    .on('click', () => selectDevice(device));\r\n\r\n                const popupContent = `\r\n                    <div style=\"min-width:180px\">\r\n                        <div style=\"font-weight:600;font-size:14px;margin-bottom:6px;color:#f1f5f9\">${device.deviceName}</div>\r\n                        <div style=\"font-size:11px;color:#64748b;margin-bottom:8px\">${device.imei}</div>\r\n                        <div style=\"display:flex;align-items:center;gap:6px;margin-bottom:4px\">\r\n                            <span style=\"width:6px;height:6px;border-radius:50%;background:${isOnline ? '#22c55e' : '#6b7280'}\"></span>\r\n                            <span style=\"font-size:12px;color:${isOnline ? '#22c55e' : '#6b7280'}\">${isOnline ? 'Online' : 'Offline'}</span>\r\n                        </div>\r\n                        <div style=\"font-size:12px;color:#94a3b8\">${device.lat.toFixed(5)}, ${device.lng.toFixed(5)}</div>\r\n                        ${device.gpsTime ? `<div style=\"font-size:11px;color:#64748b;margin-top:4px\">${device.gpsTime}</div>` : ''}\r\n                    </div>\r\n                `;\r\n                marker.bindPopup(popupContent);\r\n                markersRef.current.set(device.imei, marker);\r\n            }\r\n        });\r\n    }, [devicesWithLocation, selectedDevice, selectDevice]);\r\n\r\n    // Fly to selected device\r\n    useEffect(() => {\r\n        const map = mapRef.current;\r\n        if (!map || !selectedDevice) return;\r\n        const d = selectedDevice as any;\r\n        if (d.lat && d.lng) {\r\n            map.flyTo([d.lat, d.lng], 15, { duration: 1 });\r\n        }\r\n    }, [selectedDevice]);\r\n\r\n    return (\r\n        <div\r\n            ref={containerRef}\r\n            style={{ width: '100%', height: '100%' }}\r\n        />\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aamer\\Desktop\\SaudiEx project agents\\gimi integrartion\\gimi-tracking-app\\src\\components\\ProtectedRoute.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aamer\\Desktop\\SaudiEx project agents\\gimi integrartion\\gimi-tracking-app\\src\\components\\Sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aamer\\Desktop\\SaudiEx project agents\\gimi integrartion\\gimi-tracking-app\\src\\layouts\\DashboardLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aamer\\Desktop\\SaudiEx project agents\\gimi integrartion\\gimi-tracking-app\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aamer\\Desktop\\SaudiEx project agents\\gimi integrartion\\gimi-tracking-app\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aamer\\Desktop\\SaudiEx project agents\\gimi integrartion\\gimi-tracking-app\\src\\pages\\Alerts.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3133,3136],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3133,3136],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3242,3245],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3242,3245],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":94,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":94,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4090,4093],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4090,4093],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":95,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4170,4173],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4170,4173],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":96,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4226,4229],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4226,4229],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":97,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4282,4285],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4282,4285],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":103,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4472,4475],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4472,4475],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":117,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5243,5246],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5243,5246],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useCallback, useEffect } from 'react';\r\nimport { useAuthStore } from '../store/auth';\r\nimport { useDeviceStore } from '../store/devices';\r\nimport type { Device } from '../store/devices';\r\nimport { gimiService } from '../services/gimi';\r\n\r\ninterface Alarm {\r\n    alarmId: string;\r\n    imei: string;\r\n    alarmType: string;\r\n    alarmDesc: string;\r\n    lat: number;\r\n    lng: number;\r\n    speed: number;\r\n    gpsTime: string;\r\n    deviceName?: string;\r\n}\r\n\r\nconst ALARM_TYPE_MAP: Record<string, { label: string; icon: string; severity: 'critical' | 'warning' | 'info' }> = {\r\n    'SOS': { label: 'SOS', icon: '≡ƒåÿ', severity: 'critical' },\r\n    'offline': { label: 'Offline', icon: '≡ƒôí', severity: 'warning' },\r\n    'lowBattery': { label: 'Low Battery', icon: '≡ƒöï', severity: 'warning' },\r\n    'overspeed': { label: 'Overspeed', icon: '≡ƒÜ¿', severity: 'critical' },\r\n    'geofenceIn': { label: 'Geofence Enter', icon: '≡ƒôì', severity: 'info' },\r\n    'geofenceOut': { label: 'Geofence Exit', icon: '≡ƒôì', severity: 'warning' },\r\n    'vibration': { label: 'Vibration', icon: '≡ƒô│', severity: 'info' },\r\n    'powerOff': { label: 'Power Off', icon: 'ΓÜí', severity: 'critical' },\r\n    'lowPower': { label: 'Low Power', icon: '≡ƒöî', severity: 'warning' },\r\n    'crash': { label: 'Crash', icon: '≡ƒÆÑ', severity: 'critical' },\r\n    'fatigueDriving': { label: 'Fatigue Driving', icon: '≡ƒÿ┤', severity: 'warning' },\r\n};\r\n\r\nconst getAlarmMeta = (type: string) => {\r\n    const key = Object.keys(ALARM_TYPE_MAP).find(k => type.toLowerCase().includes(k.toLowerCase()));\r\n    if (key) return ALARM_TYPE_MAP[key];\r\n    return { label: type || 'Unknown', icon: 'ΓÜá∩╕Å', severity: 'info' as const };\r\n};\r\n\r\nconst FILTERS = [\r\n    { key: 'all', label: 'All' },\r\n    { key: 'geofence', label: 'Geofence' },\r\n    { key: 'overspeed', label: 'Speed' },\r\n    { key: 'sos', label: 'SOS' },\r\n    { key: 'battery', label: 'Battery' },\r\n    { key: 'offline', label: 'Offline' },\r\n];\r\n\r\nexport default function Alerts() {\r\n    const { accessToken, userId } = useAuthStore();\r\n    const { devices } = useDeviceStore();\r\n    const [alarms, setAlarms] = useState<Alarm[]>([]);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [activeFilter, setActiveFilter] = useState('all');\r\n\r\n    // Date range pickers\r\n    const now = new Date();\r\n    const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\r\n    const formatDate = (d: Date) => d.toISOString().slice(0, 16);\r\n    const [startDate, setStartDate] = useState(formatDate(sevenDaysAgo));\r\n    const [endDate, setEndDate] = useState(formatDate(now));\r\n    const [selectedImei, setSelectedImei] = useState('');\r\n\r\n    // Format for API: \"YYYY-MM-DD HH:mm:ss\"\r\n    const toApiDate = (d: string) => d.replace('T', ' ') + ':00';\r\n\r\n    const fetchAlarms = useCallback(async () => {\r\n        if (!accessToken || !userId) return;\r\n        setIsLoading(true);\r\n        setError(null);\r\n        try {\r\n            const begin = toApiDate(startDate);\r\n            const end = toApiDate(endDate);\r\n            let allAlarms: any[] = [];\r\n\r\n            if (selectedImei) {\r\n                // Single device\r\n                const res: any = await gimiService.getDeviceAlarms(accessToken, selectedImei, begin, end);\r\n                if (res?.result) {\r\n                    allAlarms = Array.isArray(res.result) ? res.result : (res.result?.list || []);\r\n                }\r\n            } else {\r\n                // All devices ΓÇö fetch in parallel\r\n                const imeis = devices.map((d: Device) => d.imei).filter(Boolean);\r\n                if (imeis.length === 0) {\r\n                    setAlarms([]);\r\n                    setIsLoading(false);\r\n                    return;\r\n                }\r\n                const results = await Promise.allSettled(\r\n                    imeis.map(imei => gimiService.getDeviceAlarms(accessToken, imei, begin, end))\r\n                );\r\n                for (const r of results) {\r\n                    if (r.status === 'fulfilled' && (r.value as any)?.result) {\r\n                        const list = Array.isArray((r.value as any).result)\r\n                            ? (r.value as any).result\r\n                            : ((r.value as any).result?.list || []);\r\n                        allAlarms.push(...list);\r\n                    }\r\n                }\r\n            }\r\n\r\n            const parsed: Alarm[] = allAlarms.map((a: any) => ({\r\n                alarmId: a.alarmId || a.id || `${a.imei}-${a.gpsTime}-${Math.random()}`,\r\n                imei: a.imei || '',\r\n                alarmType: a.alarmType || a.alertType || a.type || '',\r\n                alarmDesc: a.alarmDesc || a.alarmName || a.desc || a.alarmType || '',\r\n                lat: a.lat || 0,\r\n                lng: a.lng || 0,\r\n                speed: a.speed || 0,\r\n                gpsTime: a.gpsTime || a.alertTime || a.time || '',\r\n                deviceName: a.deviceName || devices.find((d: Device) => d.imei === a.imei)?.deviceName || a.imei,\r\n            }));\r\n            // Sort by time descending\r\n            parsed.sort((a, b) => b.gpsTime.localeCompare(a.gpsTime));\r\n            setAlarms(parsed);\r\n        } catch (err: any) {\r\n            setError(err.message || 'Failed to load alerts');\r\n            setAlarms([]);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    }, [accessToken, userId, selectedImei, startDate, endDate, devices]);\r\n\r\n    useEffect(() => { fetchAlarms(); }, [fetchAlarms]);\r\n\r\n    // Filter\r\n    const filteredAlarms = alarms.filter(a => {\r\n        if (activeFilter === 'all') return true;\r\n        const type = a.alarmType.toLowerCase();\r\n        if (activeFilter === 'geofence') return type.includes('fence') || type.includes('geo');\r\n        if (activeFilter === 'overspeed') return type.includes('speed');\r\n        if (activeFilter === 'sos') return type.includes('sos');\r\n        if (activeFilter === 'battery') return type.includes('batt') || type.includes('power');\r\n        if (activeFilter === 'offline') return type.includes('offline') || type.includes('disconnect');\r\n        return true;\r\n    });\r\n\r\n    const severityColor = (s: string) => {\r\n        if (s === 'critical') return 'var(--danger)';\r\n        if (s === 'warning') return 'var(--warn)';\r\n        return 'var(--accent)';\r\n    };\r\n\r\n    return (\r\n        <div style={{ height: '100%', display: 'flex', flexDirection: 'column', padding: '20px', overflow: 'auto' }}>\r\n            {/* Header */}\r\n            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '16px', flexWrap: 'wrap', gap: '12px' }}>\r\n                <h2 style={{ fontSize: '18px', fontWeight: 600, display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                    <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"var(--accent)\" strokeWidth=\"2\"><path d=\"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9\" /><path d=\"M13.73 21a2 2 0 0 1-3.46 0\" /></svg>\r\n                    Alerts\r\n                </h2>\r\n                <button onClick={fetchAlarms} className=\"sx-btn sx-btn-ghost sx-btn-sm\" disabled={isLoading}>\r\n                    {isLoading ? 'Loading...' : 'Γå╗ Refresh'}\r\n                </button>\r\n            </div>\r\n\r\n            {/* Filters bar */}\r\n            <div className=\"glass-panel-flat\" style={{ padding: '12px 16px', marginBottom: '12px' }}>\r\n                <div style={{ display: 'flex', gap: '12px', alignItems: 'center', flexWrap: 'wrap' }}>\r\n                    {/* Device selector */}\r\n                    <select\r\n                        value={selectedImei}\r\n                        onChange={(e) => setSelectedImei(e.target.value)}\r\n                        className=\"sx-select\"\r\n                        style={{ width: '200px', padding: '6px 10px', fontSize: '12px' }}\r\n                    >\r\n                        <option value=\"\">All Devices</option>\r\n                        {devices.map((d: Device) => (\r\n                            <option key={d.imei} value={d.imei}>{d.deviceName}</option>\r\n                        ))}\r\n                    </select>\r\n\r\n                    {/* Date range */}\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>\r\n                        <input\r\n                            type=\"datetime-local\"\r\n                            value={startDate}\r\n                            onChange={(e) => setStartDate(e.target.value)}\r\n                            className=\"sx-input\"\r\n                            style={{ width: '175px', padding: '6px 8px', fontSize: '12px' }}\r\n                        />\r\n                        <span style={{ color: 'var(--text-muted)', fontSize: '12px' }}>to</span>\r\n                        <input\r\n                            type=\"datetime-local\"\r\n                            value={endDate}\r\n                            onChange={(e) => setEndDate(e.target.value)}\r\n                            className=\"sx-input\"\r\n                            style={{ width: '175px', padding: '6px 8px', fontSize: '12px' }}\r\n                        />\r\n                    </div>\r\n\r\n                    <button onClick={fetchAlarms} className=\"sx-btn sx-btn-primary sx-btn-sm\">\r\n                        Search\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Type filters */}\r\n            <div style={{ display: 'flex', gap: '6px', marginBottom: '12px', flexWrap: 'wrap' }}>\r\n                {FILTERS.map(f => (\r\n                    <button\r\n                        key={f.key}\r\n                        onClick={() => setActiveFilter(f.key)}\r\n                        className={`sx-btn sx-btn-sm ${activeFilter === f.key ? 'sx-btn-primary' : 'sx-btn-ghost'}`}\r\n                    >\r\n                        {f.label}\r\n                    </button>\r\n                ))}\r\n            </div>\r\n\r\n            {/* Error */}\r\n            {error && (\r\n                <div className=\"glass-panel-flat\" style={{ padding: '12px 16px', marginBottom: '12px', background: 'rgba(239,68,68,0.1)', color: 'var(--danger)', fontSize: '13px' }}>\r\n                    ΓÜá∩╕Å {error}\r\n                </div>\r\n            )}\r\n\r\n            {/* Results */}\r\n            <div className=\"glass-panel-flat\" style={{ flex: 1, overflow: 'auto' }}>\r\n                {isLoading ? (\r\n                    <div style={{ padding: '40px', textAlign: 'center', color: 'var(--text-muted)' }}>Loading alerts...</div>\r\n                ) : filteredAlarms.length === 0 ? (\r\n                    <div style={{ padding: '40px', textAlign: 'center', color: 'var(--text-muted)' }}>\r\n                        <svg width=\"40\" height=\"40\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"var(--text-muted)\" strokeWidth=\"1.5\" style={{ display: 'block', margin: '0 auto 12px' }}>\r\n                            <path d=\"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9\" /><path d=\"M13.73 21a2 2 0 0 1-3.46 0\" />\r\n                        </svg>\r\n                        <div style={{ fontSize: '14px', fontWeight: 500, marginBottom: '4px' }}>No alerts found</div>\r\n                        <div style={{ fontSize: '12px' }}>Try adjusting the date range or filters</div>\r\n                    </div>\r\n                ) : (\r\n                    <>\r\n                        {/* Table header */}\r\n                        <div style={{\r\n                            display: 'grid',\r\n                            gridTemplateColumns: '40px 1.5fr 1fr 1fr 80px 1.2fr',\r\n                            padding: '10px 16px',\r\n                            borderBottom: '1px solid var(--border)',\r\n                            fontSize: '10px',\r\n                            fontWeight: 600,\r\n                            color: 'var(--text-muted)',\r\n                            textTransform: 'uppercase',\r\n                            letterSpacing: '0.05em',\r\n                            position: 'sticky',\r\n                            top: 0,\r\n                            background: 'var(--bg-secondary)',\r\n                            zIndex: 1,\r\n                        }}>\r\n                            <div></div>\r\n                            <div>Alert</div>\r\n                            <div>Device</div>\r\n                            <div>Type</div>\r\n                            <div>Speed</div>\r\n                            <div>Time</div>\r\n                        </div>\r\n\r\n                        {/* Rows */}\r\n                        {filteredAlarms.map((alarm) => {\r\n                            const meta = getAlarmMeta(alarm.alarmType);\r\n                            return (\r\n                                <div\r\n                                    key={alarm.alarmId}\r\n                                    style={{\r\n                                        display: 'grid',\r\n                                        gridTemplateColumns: '40px 1.5fr 1fr 1fr 80px 1.2fr',\r\n                                        padding: '12px 16px',\r\n                                        borderBottom: '1px solid var(--border)',\r\n                                        alignItems: 'center',\r\n                                        transition: 'background 0.15s',\r\n                                        cursor: 'default',\r\n                                    }}\r\n                                    onMouseEnter={(e) => (e.currentTarget.style.background = 'rgba(255,255,255,0.02)')}\r\n                                    onMouseLeave={(e) => (e.currentTarget.style.background = 'transparent')}\r\n                                >\r\n                                    {/* Icon */}\r\n                                    <div style={{ fontSize: '16px' }}>{meta.icon}</div>\r\n\r\n                                    {/* Description */}\r\n                                    <div>\r\n                                        <div style={{ fontSize: '13px', fontWeight: 500 }}>{alarm.alarmDesc || meta.label}</div>\r\n                                        <div style={{ fontSize: '11px', color: 'var(--text-muted)', marginTop: '2px' }}>\r\n                                            {alarm.lat.toFixed(4)}, {alarm.lng.toFixed(4)}\r\n                                        </div>\r\n                                    </div>\r\n\r\n                                    {/* Device */}\r\n                                    <div style={{ fontSize: '12px', color: 'var(--text-secondary)' }}>{alarm.deviceName}</div>\r\n\r\n                                    {/* Severity badge */}\r\n                                    <div>\r\n                                        <span style={{\r\n                                            display: 'inline-block',\r\n                                            padding: '2px 8px',\r\n                                            borderRadius: '20px',\r\n                                            fontSize: '10px',\r\n                                            fontWeight: 600,\r\n                                            background: `${severityColor(meta.severity)}18`,\r\n                                            color: severityColor(meta.severity),\r\n                                            border: `1px solid ${severityColor(meta.severity)}30`,\r\n                                        }}>\r\n                                            {meta.label}\r\n                                        </span>\r\n                                    </div>\r\n\r\n                                    {/* Speed */}\r\n                                    <div style={{ fontSize: '12px', fontWeight: 500 }}>\r\n                                        {alarm.speed > 0 ? `${alarm.speed} km/h` : 'ΓÇö'}\r\n                                    </div>\r\n\r\n                                    {/* Time */}\r\n                                    <div style={{ fontSize: '12px', color: 'var(--text-muted)' }}>{alarm.gpsTime}</div>\r\n                                </div>\r\n                            );\r\n                        })}\r\n\r\n                        {/* Summary */}\r\n                        <div style={{ padding: '12px 16px', fontSize: '12px', color: 'var(--text-muted)', borderTop: '1px solid var(--border)' }}>\r\n                            {filteredAlarms.length} alert{filteredAlarms.length !== 1 ? 's' : ''} found\r\n                        </div>\r\n                    </>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aamer\\Desktop\\SaudiEx project agents\\gimi integrartion\\gimi-tracking-app\\src\\pages\\Dashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[802,805],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[802,805],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":31,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1301,1304],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1301,1304],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2114,2117],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2114,2117],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":103,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4390,4393],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4390,4393],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":130,"column":104,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":107,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5933,5936],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5933,5936],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":131,"column":115,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":118,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6071,6074],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6071,6074],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":136,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":136,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6351,6354],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6351,6354],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":137,"column":90,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":93,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6474,6477],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6474,6477],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":138,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6589,6592],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6589,6592],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":139,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":139,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6700,6703],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6700,6703],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":140,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6817,6820],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6817,6820],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":141,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":141,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6925,6928],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6925,6928],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":12,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useCallback, useState } from 'react';\r\nimport { useAuthStore } from '../store/auth';\r\nimport { useDeviceStore } from '../store/devices';\r\nimport { gimiService } from '../services/gimi';\r\nimport LiveMap from '../components/LiveMap';\r\nimport DevicePanel from '../components/DevicePanel';\r\n\r\nexport default function Dashboard() {\r\n    const { accessToken, userId } = useAuthStore();\r\n    const { setDevices, updateDeviceLocations, devices, selectedDevice } = useDeviceStore();\r\n    const [loading, setLoading] = useState(true);\r\n    const [lastUpdate, setLastUpdate] = useState<string>('');\r\n    const [showPanel, setShowPanel] = useState(true);\r\n\r\n    const fetchDevices = useCallback(async () => {\r\n        if (!accessToken || !userId) return;\r\n        try {\r\n            const res: any = await gimiService.getDeviceList(accessToken, userId);\r\n            if (res?.result) {\r\n                const list = Array.isArray(res.result) ? res.result : [];\r\n                setDevices(list);\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to fetch devices:', err);\r\n        }\r\n    }, [accessToken, userId, setDevices]);\r\n\r\n    const fetchLocations = useCallback(async () => {\r\n        if (!accessToken || !userId) return;\r\n        try {\r\n            const res: any = await gimiService.getDevicesLocation(accessToken, userId);\r\n            if (res?.result && Array.isArray(res.result)) {\r\n                updateDeviceLocations(res.result);\r\n                const now = new Date();\r\n                setLastUpdate(now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }));\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to fetch locations:', err);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, [accessToken, userId, updateDeviceLocations]);\r\n\r\n    useEffect(() => {\r\n        fetchDevices().then(fetchLocations);\r\n        const interval = setInterval(fetchLocations, 15000);\r\n        return () => clearInterval(interval);\r\n    }, [fetchDevices, fetchLocations]);\r\n\r\n    const onlineCount = devices.filter((d: any) => d.status === '1' || d.posType === 'GPS').length;\r\n    const offlineCount = devices.length - onlineCount;\r\n\r\n    return (\r\n        <div style={{ position: 'relative', height: '100%', display: 'flex', flexDirection: 'column' }}>\r\n            {/* Map - full screen */}\r\n            <div style={{ flex: 1, position: 'relative' }}>\r\n                <LiveMap />\r\n\r\n                {/* Toggle panel button */}\r\n                <button\r\n                    onClick={() => setShowPanel(!showPanel)}\r\n                    className=\"sx-btn-icon\"\r\n                    style={{\r\n                        position: 'absolute',\r\n                        top: 16,\r\n                        left: showPanel ? 340 : 16,\r\n                        zIndex: 1000,\r\n                        width: 36,\r\n                        height: 36,\r\n                        background: 'var(--bg-secondary)',\r\n                        border: '1px solid var(--border)',\r\n                        borderRadius: 'var(--radius-md)',\r\n                        transition: 'left 0.3s ease',\r\n                    }}\r\n                >\r\n                    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n                        {showPanel ? (\r\n                            <><polyline points=\"15 18 9 12 15 6\" /></>\r\n                        ) : (\r\n                            <><polyline points=\"9 18 15 12 9 6\" /></>\r\n                        )}\r\n                    </svg>\r\n                </button>\r\n\r\n                {/* Floating device panel */}\r\n                {showPanel && (\r\n                    <div\r\n                        className=\"animate-slide-left\"\r\n                        style={{\r\n                            position: 'absolute',\r\n                            top: 16,\r\n                            left: 16,\r\n                            bottom: 52,\r\n                            width: 320,\r\n                            zIndex: 999,\r\n                        }}\r\n                    >\r\n                        <DevicePanel />\r\n                    </div>\r\n                )}\r\n\r\n                {/* Device detail card (right side) when selected */}\r\n                {selectedDevice && (selectedDevice as any).lat && (\r\n                    <div\r\n                        className=\"glass-panel animate-slide-right\"\r\n                        style={{\r\n                            position: 'absolute',\r\n                            top: 16,\r\n                            right: 16,\r\n                            width: 280,\r\n                            padding: '20px',\r\n                            zIndex: 999,\r\n                        }}\r\n                    >\r\n                        <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '16px' }}>\r\n                            <div style={{\r\n                                width: 36,\r\n                                height: 36,\r\n                                borderRadius: '10px',\r\n                                background: 'var(--accent-dim)',\r\n                                display: 'flex',\r\n                                alignItems: 'center',\r\n                                justifyContent: 'center',\r\n                            }}>\r\n                                <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"var(--accent)\" strokeWidth=\"2\">\r\n                                    <circle cx=\"12\" cy=\"10\" r=\"3\" /><path d=\"M12 2a8 8 0 0 0-8 8c0 5.4 7 11.5 7.3 11.8a1 1 0 0 0 1.4 0C13 21.5 20 15.4 20 10a8 8 0 0 0-8-8z\" />\r\n                                </svg>\r\n                            </div>\r\n                            <div>\r\n                                <div style={{ fontWeight: 600, fontSize: '14px' }}>{(selectedDevice as any).deviceName}</div>\r\n                                <div style={{ fontSize: '11px', color: 'var(--text-muted)' }}>{(selectedDevice as any).imei}</div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px' }}>\r\n                            <InfoTile label=\"Latitude\" value={String((selectedDevice as any).lat?.toFixed(5) || 'ΓÇö')} />\r\n                            <InfoTile label=\"Longitude\" value={String((selectedDevice as any).lng?.toFixed(5) || 'ΓÇö')} />\r\n                            <InfoTile label=\"Speed\" value={`${(selectedDevice as any).speed || 0} km/h`} />\r\n                            <InfoTile label=\"Battery\" value={`${(selectedDevice as any).batteryPowerVal || 'ΓÇö'}%`} />\r\n                            <InfoTile label=\"Position\" value={(selectedDevice as any).posType || 'N/A'} />\r\n                            <InfoTile label=\"GPS Time\" value={(selectedDevice as any).gpsTime?.split(' ')[1] || 'ΓÇö'} />\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Status Bar */}\r\n            <div style={{\r\n                height: 'var(--statusbar-height)',\r\n                background: 'var(--bg-secondary)',\r\n                borderTop: '1px solid var(--border)',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                padding: '0 16px',\r\n                gap: '20px',\r\n                fontSize: '12px',\r\n                color: 'var(--text-muted)',\r\n                flexShrink: 0,\r\n            }}>\r\n                <span>{devices.length} device{devices.length !== 1 ? 's' : ''}</span>\r\n                <span style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>\r\n                    <span className=\"status-dot status-dot--online\" style={{ width: 6, height: 6 }} />\r\n                    {onlineCount} online\r\n                </span>\r\n                <span style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>\r\n                    <span className=\"status-dot status-dot--offline\" style={{ width: 6, height: 6 }} />\r\n                    {offlineCount} offline\r\n                </span>\r\n                <span style={{ marginLeft: 'auto' }}>\r\n                    {loading ? 'Loading...' : `Updated ${lastUpdate}`}\r\n                </span>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction InfoTile({ label, value }: { label: string; value: string }) {\r\n    return (\r\n        <div style={{\r\n            padding: '10px',\r\n            borderRadius: 'var(--radius-sm)',\r\n            background: 'rgba(255,255,255,0.03)',\r\n            border: '1px solid var(--border)',\r\n        }}>\r\n            <div style={{ fontSize: '10px', color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: '0.05em', marginBottom: '4px' }}>{label}</div>\r\n            <div style={{ fontSize: '13px', fontWeight: 600 }}>{value}</div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aamer\\Desktop\\SaudiEx project agents\\gimi integrartion\\gimi-tracking-app\\src\\pages\\Geofences.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":102,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4030,4033],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4030,4033],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":105,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":105,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4259,4262],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4259,4262],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":117,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4785,4788],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4785,4788],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":154,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6172,6175],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6172,6175],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":168,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":168,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6690,6693],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6690,6693],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":186,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":186,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7380,7383],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7380,7383],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useCallback, useEffect, useRef } from 'react';\r\nimport { useAuthStore } from '../store/auth';\r\nimport { useDeviceStore } from '../store/devices';\r\nimport type { Device } from '../store/devices';\r\nimport { gimiService } from '../services/gimi';\r\nimport L from 'leaflet';\r\nimport 'leaflet/dist/leaflet.css';\r\n\r\nconst TILE_URL = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';\r\nconst TILE_ATTR = '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors';\r\n\r\ninterface Geofence {\r\n    fenceId: string;\r\n    fenceName: string;\r\n    lat: number;\r\n    lng: number;\r\n    radius: number;\r\n    type: string;\r\n    imei?: string;\r\n}\r\n\r\nexport default function Geofences() {\r\n    const { accessToken, userId } = useAuthStore();\r\n    const { devices } = useDeviceStore();\r\n    const [geofences, setGeofences] = useState<Geofence[]>([]);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [successMsg, setSuccessMsg] = useState<string | null>(null);\r\n\r\n    // Creation state\r\n    const [showCreateForm, setShowCreateForm] = useState(false);\r\n    const [creating, setCreating] = useState(false);\r\n    const [newFenceLat, setNewFenceLat] = useState<number | null>(null);\r\n    const [newFenceLng, setNewFenceLng] = useState<number | null>(null);\r\n    const [newFenceName, setNewFenceName] = useState('');\r\n    const [newFenceRadius, setNewFenceRadius] = useState(500);\r\n    const [newFenceImei, setNewFenceImei] = useState('');\r\n    const [newFenceAlarmType, setNewFenceAlarmType] = useState<'IN' | 'OUT' | 'IN_OUT'>('IN_OUT');\r\n\r\n    // Map\r\n    const mapRef = useRef<L.Map | null>(null);\r\n    const containerRef = useRef<HTMLDivElement>(null);\r\n    const circlePreviewRef = useRef<L.Circle | null>(null);\r\n    const markerPreviewRef = useRef<L.Marker | null>(null);\r\n    const fenceLayersRef = useRef<L.Layer[]>([]);\r\n\r\n    // Init map\r\n    useEffect(() => {\r\n        if (!containerRef.current || mapRef.current) return;\r\n        const map = L.map(containerRef.current, {\r\n            center: [24.7136, 46.6753],\r\n            zoom: 6,\r\n            zoomControl: true,\r\n        });\r\n        L.tileLayer(TILE_URL, { attribution: TILE_ATTR, maxZoom: 18 }).addTo(map);\r\n        mapRef.current = map;\r\n\r\n        // Click on map to set geofence center\r\n        map.on('click', (e: L.LeafletMouseEvent) => {\r\n            setNewFenceLat(e.latlng.lat);\r\n            setNewFenceLng(e.latlng.lng);\r\n            setShowCreateForm(true);\r\n        });\r\n\r\n        return () => { map.remove(); mapRef.current = null; };\r\n    }, []);\r\n\r\n    // Preview circle when position is set\r\n    useEffect(() => {\r\n        const map = mapRef.current;\r\n        if (!map) return;\r\n\r\n        if (circlePreviewRef.current) circlePreviewRef.current.remove();\r\n        if (markerPreviewRef.current) markerPreviewRef.current.remove();\r\n\r\n        if (newFenceLat !== null && newFenceLng !== null) {\r\n            circlePreviewRef.current = L.circle([newFenceLat, newFenceLng], {\r\n                radius: newFenceRadius,\r\n                color: '#00d4aa',\r\n                fillColor: '#00d4aa',\r\n                fillOpacity: 0.15,\r\n                weight: 2,\r\n                dashArray: '8 4',\r\n            }).addTo(map);\r\n\r\n            const icon = L.divIcon({\r\n                className: '',\r\n                iconSize: [16, 16],\r\n                iconAnchor: [8, 8],\r\n                html: '<div style=\"width:16px;height:16px;border-radius:50%;background:var(--accent);border:2px solid #fff;box-shadow:0 0 10px rgba(0,212,170,0.5)\"></div>',\r\n            });\r\n            markerPreviewRef.current = L.marker([newFenceLat, newFenceLng], { icon }).addTo(map);\r\n        }\r\n    }, [newFenceLat, newFenceLng, newFenceRadius]);\r\n\r\n    // Fetch existing geofences\r\n    const fetchGeofences = useCallback(async () => {\r\n        if (!accessToken || !userId) return;\r\n        setIsLoading(true);\r\n        setError(null);\r\n        try {\r\n            const res: any = await gimiService.getGeofences(accessToken, userId);\r\n            if (res?.result) {\r\n                const rawList = Array.isArray(res.result) ? res.result : [];\r\n                const fences: Geofence[] = rawList.map((f: any) => ({\r\n                    fenceId: f.fenceId || f.fenceSerialNo || f.id,\r\n                    fenceName: f.fenceName || f.name || 'Unnamed',\r\n                    lat: f.lat || f.centerLat,\r\n                    lng: f.lng || f.centerLng,\r\n                    radius: f.radius ? f.radius * 100 : 500,\r\n                    type: f.type || 'circle',\r\n                    imei: f.imei,\r\n                }));\r\n                setGeofences(fences);\r\n                drawGeofences(fences);\r\n            }\r\n        } catch (err: any) {\r\n            setError(err.message);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    }, [accessToken, userId]);\r\n\r\n    useEffect(() => { fetchGeofences(); }, [fetchGeofences]);\r\n\r\n    const drawGeofences = (fences: Geofence[]) => {\r\n        const map = mapRef.current;\r\n        if (!map) return;\r\n        fenceLayersRef.current.forEach(l => l.remove());\r\n        fenceLayersRef.current = [];\r\n\r\n        const colors = ['#00d4aa', '#8b5cf6', '#f59e0b', '#ef4444', '#3b82f6'];\r\n        fences.forEach((fence, i) => {\r\n            if (fence.lat && fence.lng) {\r\n                const circle = L.circle([fence.lat, fence.lng], {\r\n                    radius: fence.radius,\r\n                    color: colors[i % colors.length],\r\n                    fillColor: colors[i % colors.length],\r\n                    fillOpacity: 0.1,\r\n                    weight: 2,\r\n                }).addTo(map).bindPopup(`<strong>${fence.fenceName}</strong><br/>Radius: ${fence.radius}m`);\r\n                fenceLayersRef.current.push(circle);\r\n            }\r\n        });\r\n    };\r\n\r\n    // Create geofence\r\n    const handleCreate = async () => {\r\n        if (!accessToken || !newFenceImei || !newFenceName || newFenceLat === null || newFenceLng === null) return;\r\n        setCreating(true);\r\n        setError(null);\r\n        setSuccessMsg(null);\r\n        try {\r\n            const res: any = await gimiService.createDeviceFence(\r\n                accessToken,\r\n                newFenceImei,\r\n                newFenceName,\r\n                newFenceLat,\r\n                newFenceLng,\r\n                newFenceRadius,\r\n                newFenceAlarmType,\r\n            );\r\n            if (res?.code === 0 || res?.result) {\r\n                setSuccessMsg(`Geofence \"${newFenceName}\" created successfully!`);\r\n                resetForm();\r\n                fetchGeofences();\r\n            }\r\n        } catch (err: any) {\r\n            setError(err.message || 'Failed to create geofence');\r\n        } finally {\r\n            setCreating(false);\r\n        }\r\n    };\r\n\r\n    // Delete geofence\r\n    const handleDelete = async (fence: Geofence) => {\r\n        if (!accessToken || !fence.imei || !fence.fenceId) {\r\n            setError('Cannot delete: missing device or fence ID');\r\n            return;\r\n        }\r\n        if (!confirm(`Delete geofence \"${fence.fenceName}\"?`)) return;\r\n        try {\r\n            await gimiService.deleteDeviceFence(accessToken, fence.imei, fence.fenceId);\r\n            setSuccessMsg(`Geofence \"${fence.fenceName}\" deleted`);\r\n            fetchGeofences();\r\n        } catch (err: any) {\r\n            setError(err.message || 'Failed to delete geofence');\r\n        }\r\n    };\r\n\r\n    const resetForm = () => {\r\n        setShowCreateForm(false);\r\n        setNewFenceLat(null);\r\n        setNewFenceLng(null);\r\n        setNewFenceName('');\r\n        setNewFenceRadius(500);\r\n        setNewFenceImei('');\r\n        if (circlePreviewRef.current) circlePreviewRef.current.remove();\r\n        if (markerPreviewRef.current) markerPreviewRef.current.remove();\r\n    };\r\n\r\n    return (\r\n        <div style={{ position: 'relative', height: '100%' }}>\r\n            {/* Map */}\r\n            <div ref={containerRef} style={{ width: '100%', height: '100%' }} />\r\n\r\n            {/* Floating panel ΓÇö existing geofences */}\r\n            <div\r\n                className=\"glass-panel animate-slide-left\"\r\n                style={{\r\n                    position: 'absolute',\r\n                    top: 16,\r\n                    left: 16,\r\n                    width: 320,\r\n                    maxHeight: 'calc(100% - 32px)',\r\n                    zIndex: 1000,\r\n                    display: 'flex',\r\n                    flexDirection: 'column',\r\n                    overflow: 'hidden',\r\n                }}\r\n            >\r\n                {/* Header */}\r\n                <div style={{\r\n                    padding: '16px',\r\n                    borderBottom: '1px solid var(--border)',\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'space-between',\r\n                }}>\r\n                    <h3 style={{ fontSize: '14px', fontWeight: 600, display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"var(--accent)\" strokeWidth=\"2\"><polygon points=\"12 2 22 8.5 22 15.5 12 22 2 15.5 2 8.5 12 2\" /></svg>\r\n                        Geofences\r\n                    </h3>\r\n                    <span className=\"badge badge-online\">{geofences.length}</span>\r\n                </div>\r\n\r\n                {/* Instructions */}\r\n                <div style={{ padding: '8px 16px', fontSize: '11px', color: 'var(--text-muted)', borderBottom: '1px solid var(--border)' }}>\r\n                    ≡ƒôì Click on the map to add a new geofence\r\n                </div>\r\n\r\n                {/* Messages */}\r\n                {error && (\r\n                    <div style={{ margin: '8px', padding: '8px 12px', borderRadius: 'var(--radius-sm)', background: 'rgba(239,68,68,0.1)', color: 'var(--danger)', fontSize: '12px' }}>\r\n                        {error}\r\n                    </div>\r\n                )}\r\n                {successMsg && (\r\n                    <div style={{ margin: '8px', padding: '8px 12px', borderRadius: 'var(--radius-sm)', background: 'rgba(34,197,94,0.1)', color: 'var(--online)', fontSize: '12px' }}>\r\n                        {successMsg}\r\n                    </div>\r\n                )}\r\n\r\n                {/* Content */}\r\n                <div style={{ flex: 1, overflowY: 'auto', padding: '8px' }}>\r\n                    {isLoading ? (\r\n                        <div style={{ padding: '20px', textAlign: 'center', color: 'var(--text-muted)', fontSize: '13px' }}>Loading...</div>\r\n                    ) : geofences.length === 0 ? (\r\n                        <div style={{ padding: '20px', textAlign: 'center', color: 'var(--text-muted)', fontSize: '13px' }}>\r\n                            <svg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"var(--text-muted)\" strokeWidth=\"1.5\" style={{ display: 'block', margin: '0 auto 8px' }}>\r\n                                <polygon points=\"12 2 22 8.5 22 15.5 12 22 2 15.5 2 8.5 12 2\" />\r\n                            </svg>\r\n                            No geofences yet. Click the map to create one.\r\n                        </div>\r\n                    ) : (\r\n                        geofences.map((fence, i) => {\r\n                            const colors = ['#00d4aa', '#8b5cf6', '#f59e0b', '#ef4444', '#3b82f6'];\r\n                            const color = colors[i % colors.length];\r\n                            return (\r\n                                <div\r\n                                    key={fence.fenceId}\r\n                                    style={{ padding: '12px', borderRadius: 'var(--radius-md)', border: '1px solid var(--border)', marginBottom: '4px', transition: 'background 0.15s' }}\r\n                                    onMouseEnter={(e) => (e.currentTarget.style.background = 'rgba(255,255,255,0.03)')}\r\n                                    onMouseLeave={(e) => (e.currentTarget.style.background = 'transparent')}\r\n                                >\r\n                                    <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\r\n                                        <div style={{ display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer' }}\r\n                                            onClick={() => { if (mapRef.current && fence.lat && fence.lng) mapRef.current.flyTo([fence.lat, fence.lng], 14, { duration: 1 }); }}>\r\n                                            <div style={{ width: 10, height: 10, borderRadius: '50%', background: color, flexShrink: 0 }} />\r\n                                            <span style={{ fontSize: '13px', fontWeight: 500 }}>{fence.fenceName}</span>\r\n                                        </div>\r\n                                        <button\r\n                                            onClick={() => handleDelete(fence)}\r\n                                            className=\"sx-btn-icon\"\r\n                                            style={{ width: 28, height: 28, color: 'var(--danger)' }}\r\n                                            title=\"Delete\"\r\n                                        >\r\n                                            <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\"><polyline points=\"3 6 5 6 21 6\" /><path d=\"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\" /></svg>\r\n                                        </button>\r\n                                    </div>\r\n                                    <div style={{ fontSize: '11px', color: 'var(--text-muted)', marginTop: '4px', marginLeft: '18px' }}>\r\n                                        Radius: {fence.radius}m {fence.imei && `┬╖ ${fence.imei}`}\r\n                                    </div>\r\n                                </div>\r\n                            );\r\n                        })\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Create form ΓÇö appears when map is clicked */}\r\n            {showCreateForm && newFenceLat !== null && newFenceLng !== null && (\r\n                <div\r\n                    className=\"glass-panel animate-slide-right\"\r\n                    style={{\r\n                        position: 'absolute',\r\n                        top: 16,\r\n                        right: 16,\r\n                        width: 300,\r\n                        padding: '20px',\r\n                        zIndex: 1000,\r\n                    }}\r\n                >\r\n                    <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '16px' }}>\r\n                        <h3 style={{ fontSize: '14px', fontWeight: 600, display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"var(--accent)\" strokeWidth=\"2\"><line x1=\"12\" y1=\"5\" x2=\"12\" y2=\"19\" /><line x1=\"5\" y1=\"12\" x2=\"19\" y2=\"12\" /></svg>\r\n                            New Geofence\r\n                        </h3>\r\n                        <button onClick={resetForm} className=\"sx-btn-icon\" style={{ width: 28, height: 28 }}>\r\n                            <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\"><line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\" /><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\" /></svg>\r\n                        </button>\r\n                    </div>\r\n\r\n                    {/* Position display */}\r\n                    <div style={{ padding: '8px 12px', borderRadius: 'var(--radius-sm)', background: 'rgba(0,212,170,0.08)', border: '1px solid var(--border-accent)', marginBottom: '12px', fontSize: '12px' }}>\r\n                        <span style={{ color: 'var(--text-muted)' }}>Position: </span>\r\n                        <span style={{ color: 'var(--accent)', fontWeight: 600 }}>{newFenceLat.toFixed(5)}, {newFenceLng.toFixed(5)}</span>\r\n                    </div>\r\n\r\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '10px', marginBottom: '16px' }}>\r\n                        {/* Fence name */}\r\n                        <div>\r\n                            <label style={{ fontSize: '10px', color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: '0.05em' }}>Fence Name</label>\r\n                            <input\r\n                                type=\"text\"\r\n                                value={newFenceName}\r\n                                onChange={(e) => setNewFenceName(e.target.value)}\r\n                                className=\"sx-input\"\r\n                                placeholder=\"e.g. Warehouse Zone\"\r\n                                style={{ marginTop: '4px', fontSize: '13px', padding: '8px 12px' }}\r\n                            />\r\n                        </div>\r\n\r\n                        {/* Device */}\r\n                        <div>\r\n                            <label style={{ fontSize: '10px', color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: '0.05em' }}>Device</label>\r\n                            <select\r\n                                value={newFenceImei}\r\n                                onChange={(e) => setNewFenceImei(e.target.value)}\r\n                                className=\"sx-select\"\r\n                                style={{ marginTop: '4px', fontSize: '13px', padding: '8px 12px' }}\r\n                            >\r\n                                <option value=\"\">Select device...</option>\r\n                                {devices.map((d: Device) => (\r\n                                    <option key={d.imei} value={d.imei}>{d.deviceName}</option>\r\n                                ))}\r\n                            </select>\r\n                        </div>\r\n\r\n                        {/* Radius */}\r\n                        <div>\r\n                            <div style={{ display: 'flex', justifyContent: 'space-between' }}>\r\n                                <label style={{ fontSize: '10px', color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: '0.05em' }}>Radius</label>\r\n                                <span style={{ fontSize: '12px', color: 'var(--accent)', fontWeight: 600 }}>{newFenceRadius}m</span>\r\n                            </div>\r\n                            <input\r\n                                type=\"range\"\r\n                                min={100}\r\n                                max={10000}\r\n                                step={100}\r\n                                value={newFenceRadius}\r\n                                onChange={(e) => setNewFenceRadius(Number(e.target.value))}\r\n                                style={{ width: '100%', accentColor: 'var(--accent)', marginTop: '4px' }}\r\n                            />\r\n                        </div>\r\n\r\n                        {/* Alarm type */}\r\n                        <div>\r\n                            <label style={{ fontSize: '10px', color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: '0.05em' }}>Alarm Type</label>\r\n                            <div style={{ display: 'flex', gap: '6px', marginTop: '6px' }}>\r\n                                {(['IN', 'OUT', 'IN_OUT'] as const).map(type => (\r\n                                    <button\r\n                                        key={type}\r\n                                        onClick={() => setNewFenceAlarmType(type)}\r\n                                        className={`sx-btn sx-btn-sm ${newFenceAlarmType === type ? 'sx-btn-primary' : 'sx-btn-ghost'}`}\r\n                                        style={{ flex: 1, fontSize: '11px' }}\r\n                                    >\r\n                                        {type === 'IN_OUT' ? 'Both' : type === 'IN' ? 'Enter' : 'Exit'}\r\n                                    </button>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Create button */}\r\n                    <button\r\n                        onClick={handleCreate}\r\n                        disabled={creating || !newFenceName || !newFenceImei}\r\n                        className=\"sx-btn sx-btn-primary\"\r\n                        style={{ width: '100%' }}\r\n                    >\r\n                        {creating ? 'Creating...' : 'Create Geofence'}\r\n                    </button>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aamer\\Desktop\\SaudiEx project agents\\gimi integrartion\\gimi-tracking-app\\src\\pages\\History.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'userId' is assigned a value but never used.","line":21,"column":26,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":32},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2751,2754],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2751,2754],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":76,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2959,2962],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2959,2962],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":88,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3394,3397],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3394,3397],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useCallback, useRef, useEffect } from 'react';\r\nimport { useAuthStore } from '../store/auth';\r\nimport { useDeviceStore } from '../store/devices';\r\nimport type { Device } from '../store/devices';\r\nimport { gimiService } from '../services/gimi';\r\nimport L from 'leaflet';\r\nimport 'leaflet/dist/leaflet.css';\r\n\r\nconst TILE_URL = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';\r\nconst TILE_ATTR = '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors';\r\n\r\ninterface TrackPoint {\r\n    lat: number;\r\n    lng: number;\r\n    speed: number;\r\n    gpsTime: string;\r\n    direction: number;\r\n}\r\n\r\nexport default function History() {\r\n    const { accessToken, userId } = useAuthStore();\r\n    const { devices } = useDeviceStore();\r\n    const [selectedImei, setSelectedImei] = useState('');\r\n    const [startTime, setStartTime] = useState('');\r\n    const [endTime, setEndTime] = useState('');\r\n    const [track, setTrack] = useState<TrackPoint[]>([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    // Playback\r\n    const [playing, setPlaying] = useState(false);\r\n    const [playbackIndex, setPlaybackIndex] = useState(0);\r\n    const [playbackSpeed, setPlaybackSpeed] = useState(1);\r\n    const playIntervalRef = useRef<number | null>(null);\r\n\r\n    // Map\r\n    const mapRef = useRef<L.Map | null>(null);\r\n    const containerRef = useRef<HTMLDivElement>(null);\r\n    const polylineRef = useRef<L.Polyline | null>(null);\r\n    const markerRef = useRef<L.Marker | null>(null);\r\n\r\n    // Set default dates\r\n    useEffect(() => {\r\n        const now = new Date();\r\n        const dayAgo = new Date(now.getTime() - 24 * 60 * 60 * 1000);\r\n        setStartTime(dayAgo.toISOString().slice(0, 16));\r\n        setEndTime(now.toISOString().slice(0, 16));\r\n    }, []);\r\n\r\n    // Init map\r\n    useEffect(() => {\r\n        if (!containerRef.current || mapRef.current) return;\r\n        const map = L.map(containerRef.current, {\r\n            center: [24.7136, 46.6753],\r\n            zoom: 6,\r\n            zoomControl: true,\r\n        });\r\n        L.tileLayer(TILE_URL, { attribution: TILE_ATTR, maxZoom: 18 }).addTo(map);\r\n        mapRef.current = map;\r\n        return () => { map.remove(); mapRef.current = null; };\r\n    }, []);\r\n\r\n    const loadTrack = useCallback(async () => {\r\n        if (!accessToken || !selectedImei || !startTime || !endTime) return;\r\n        setLoading(true);\r\n        setError(null);\r\n        setTrack([]);\r\n        setPlaybackIndex(0);\r\n        setPlaying(false);\r\n\r\n        try {\r\n            const sTime = startTime.replace('T', ' ') + ':00';\r\n            const eTime = endTime.replace('T', ' ') + ':00';\r\n            const res: any = await gimiService.getTrackHistory(accessToken, selectedImei, sTime, eTime);\r\n            if (res?.result && Array.isArray(res.result)) {\r\n                const points: TrackPoint[] = res.result.map((p: any) => ({\r\n                    lat: p.lat,\r\n                    lng: p.lng,\r\n                    speed: p.speed || 0,\r\n                    gpsTime: p.gpsTime || '',\r\n                    direction: p.direction || 0,\r\n                }));\r\n                setTrack(points);\r\n                drawTrack(points);\r\n            } else {\r\n                setError('No track data found for this period');\r\n            }\r\n        } catch (err: any) {\r\n            setError(err.message);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, [accessToken, selectedImei, startTime, endTime]);\r\n\r\n    const getSpeedColor = (speed: number) => {\r\n        if (speed <= 0) return '#6b7280';\r\n        if (speed < 30) return '#22c55e';\r\n        if (speed < 60) return '#00d4aa';\r\n        if (speed < 90) return '#f59e0b';\r\n        return '#ef4444';\r\n    };\r\n\r\n    const drawTrack = (points: TrackPoint[]) => {\r\n        const map = mapRef.current;\r\n        if (!map || points.length === 0) return;\r\n\r\n        // Clear previous\r\n        if (polylineRef.current) polylineRef.current.remove();\r\n        if (markerRef.current) markerRef.current.remove();\r\n\r\n        // Draw colored polyline segments\r\n        const latLngs: L.LatLngExpression[] = points.map(p => [p.lat, p.lng]);\r\n\r\n        // Main polyline\r\n        polylineRef.current = L.polyline(latLngs, {\r\n            color: 'var(--accent)',\r\n            weight: 3,\r\n            opacity: 0.8,\r\n        }).addTo(map);\r\n\r\n        // Start marker\r\n        L.circleMarker([points[0].lat, points[0].lng], {\r\n            radius: 6,\r\n            fillColor: '#22c55e',\r\n            fillOpacity: 1,\r\n            color: '#fff',\r\n            weight: 2,\r\n        }).addTo(map).bindPopup(`<strong>Start</strong><br/>${points[0].gpsTime}`);\r\n\r\n        // End marker\r\n        const last = points[points.length - 1];\r\n        L.circleMarker([last.lat, last.lng], {\r\n            radius: 6,\r\n            fillColor: '#ef4444',\r\n            fillOpacity: 1,\r\n            color: '#fff',\r\n            weight: 2,\r\n        }).addTo(map).bindPopup(`<strong>End</strong><br/>${last.gpsTime}`);\r\n\r\n        // Playback marker\r\n        const playIcon = L.divIcon({\r\n            className: '',\r\n            iconSize: [24, 24],\r\n            iconAnchor: [12, 12],\r\n            html: `<div style=\"width:24px;height:24px;border-radius:50%;background:var(--accent);border:3px solid #fff;box-shadow:0 0 12px rgba(0,212,170,0.5)\"></div>`,\r\n        });\r\n        markerRef.current = L.marker([points[0].lat, points[0].lng], { icon: playIcon }).addTo(map);\r\n\r\n        map.fitBounds(polylineRef.current.getBounds(), { padding: [50, 50] });\r\n    };\r\n\r\n    // Playback controls\r\n    useEffect(() => {\r\n        if (playing && track.length > 0) {\r\n            playIntervalRef.current = window.setInterval(() => {\r\n                setPlaybackIndex(prev => {\r\n                    if (prev >= track.length - 1) {\r\n                        setPlaying(false);\r\n                        return prev;\r\n                    }\r\n                    const next = prev + 1;\r\n                    if (markerRef.current) {\r\n                        markerRef.current.setLatLng([track[next].lat, track[next].lng]);\r\n                    }\r\n                    return next;\r\n                });\r\n            }, 500 / playbackSpeed);\r\n        }\r\n        return () => {\r\n            if (playIntervalRef.current) clearInterval(playIntervalRef.current);\r\n        };\r\n    }, [playing, playbackSpeed, track]);\r\n\r\n    const currentPoint = track[playbackIndex];\r\n\r\n    return (\r\n        <div style={{ position: 'relative', height: '100%', display: 'flex', flexDirection: 'column' }}>\r\n            {/* Map */}\r\n            <div ref={containerRef} style={{ flex: 1 }} />\r\n\r\n            {/* Floating controls - top left */}\r\n            <div\r\n                className=\"glass-panel animate-slide-left\"\r\n                style={{\r\n                    position: 'absolute',\r\n                    top: 16,\r\n                    left: 16,\r\n                    width: 300,\r\n                    padding: '16px',\r\n                    zIndex: 1000,\r\n                }}\r\n            >\r\n                <h3 style={{ fontSize: '14px', fontWeight: 600, marginBottom: '12px', display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                    <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"var(--accent)\" strokeWidth=\"2\"><circle cx=\"12\" cy=\"12\" r=\"10\" /><polyline points=\"12 6 12 12 16 14\" /></svg>\r\n                    Track History\r\n                </h3>\r\n\r\n                <select\r\n                    value={selectedImei}\r\n                    onChange={(e) => setSelectedImei(e.target.value)}\r\n                    className=\"sx-select\"\r\n                    style={{ marginBottom: '8px' }}\r\n                >\r\n                    <option value=\"\">Select device...</option>\r\n                    {devices.map((d: Device) => (\r\n                        <option key={d.imei} value={d.imei}>{d.deviceName} ({d.imei})</option>\r\n                    ))}\r\n                </select>\r\n\r\n                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '8px', marginBottom: '12px' }}>\r\n                    <div>\r\n                        <label style={{ fontSize: '10px', color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: '0.05em' }}>From</label>\r\n                        <input type=\"datetime-local\" value={startTime} onChange={(e) => setStartTime(e.target.value)} className=\"sx-input\" style={{ fontSize: '12px', padding: '6px 8px', marginTop: '4px' }} />\r\n                    </div>\r\n                    <div>\r\n                        <label style={{ fontSize: '10px', color: 'var(--text-muted)', textTransform: 'uppercase', letterSpacing: '0.05em' }}>To</label>\r\n                        <input type=\"datetime-local\" value={endTime} onChange={(e) => setEndTime(e.target.value)} className=\"sx-input\" style={{ fontSize: '12px', padding: '6px 8px', marginTop: '4px' }} />\r\n                    </div>\r\n                </div>\r\n\r\n                <button\r\n                    onClick={loadTrack}\r\n                    disabled={loading || !selectedImei}\r\n                    className=\"sx-btn sx-btn-primary sx-btn-sm\"\r\n                    style={{ width: '100%' }}\r\n                >\r\n                    {loading ? 'Loading...' : `Load Track`}\r\n                </button>\r\n\r\n                {error && (\r\n                    <div style={{ marginTop: '8px', padding: '8px', borderRadius: 'var(--radius-sm)', background: 'rgba(239,68,68,0.1)', color: 'var(--danger)', fontSize: '12px' }}>\r\n                        {error}\r\n                    </div>\r\n                )}\r\n\r\n                {track.length > 0 && (\r\n                    <div style={{ marginTop: '8px', fontSize: '12px', color: 'var(--text-muted)' }}>\r\n                        {track.length} points loaded\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Playback bar - bottom */}\r\n            {track.length > 0 && (\r\n                <div\r\n                    className=\"glass-panel animate-slide-up\"\r\n                    style={{\r\n                        position: 'absolute',\r\n                        bottom: 16,\r\n                        left: '50%',\r\n                        transform: 'translateX(-50%)',\r\n                        width: 'min(600px, calc(100% - 32px))',\r\n                        padding: '12px 16px',\r\n                        zIndex: 1000,\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        gap: '12px',\r\n                    }}\r\n                >\r\n                    {/* Play/Pause */}\r\n                    <button\r\n                        onClick={() => {\r\n                            if (playbackIndex >= track.length - 1) setPlaybackIndex(0);\r\n                            setPlaying(!playing);\r\n                        }}\r\n                        className=\"sx-btn-icon\"\r\n                        style={{ width: 36, height: 36, flexShrink: 0 }}\r\n                    >\r\n                        {playing ? (\r\n                            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"var(--accent)\" stroke=\"none\"><rect x=\"6\" y=\"4\" width=\"4\" height=\"16\" /><rect x=\"14\" y=\"4\" width=\"4\" height=\"16\" /></svg>\r\n                        ) : (\r\n                            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"var(--accent)\" stroke=\"none\"><polygon points=\"5 3 19 12 5 21 5 3\" /></svg>\r\n                        )}\r\n                    </button>\r\n\r\n                    {/* Progress slider */}\r\n                    <input\r\n                        type=\"range\"\r\n                        min={0}\r\n                        max={track.length - 1}\r\n                        value={playbackIndex}\r\n                        onChange={(e) => {\r\n                            const idx = parseInt(e.target.value);\r\n                            setPlaybackIndex(idx);\r\n                            if (markerRef.current) markerRef.current.setLatLng([track[idx].lat, track[idx].lng]);\r\n                        }}\r\n                        style={{ flex: 1, accentColor: 'var(--accent)' }}\r\n                    />\r\n\r\n                    {/* Speed selector */}\r\n                    <select\r\n                        value={playbackSpeed}\r\n                        onChange={(e) => setPlaybackSpeed(Number(e.target.value))}\r\n                        className=\"sx-select\"\r\n                        style={{ width: '70px', padding: '4px 8px', fontSize: '12px' }}\r\n                    >\r\n                        <option value={1}>1x</option>\r\n                        <option value={2}>2x</option>\r\n                        <option value={5}>5x</option>\r\n                        <option value={10}>10x</option>\r\n                    </select>\r\n\r\n                    {/* Current point info */}\r\n                    {currentPoint && (\r\n                        <div style={{ fontSize: '11px', color: 'var(--text-muted)', whiteSpace: 'nowrap' }}>\r\n                            <span style={{ color: getSpeedColor(currentPoint.speed) }}>{currentPoint.speed} km/h</span>\r\n                            {' ┬╖ '}\r\n                            {currentPoint.gpsTime?.split(' ')[1] || ''}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aamer\\Desktop\\SaudiEx project agents\\gimi integrartion\\gimi-tracking-app\\src\\pages\\Login.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[778,781],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[778,781],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1226,1229],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1226,1229],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, FormEvent } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { gimiService } from '../services/gimi';\r\nimport { useAuthStore } from '../store/auth';\r\n\r\nconst APP_KEY = '8FB345B8693CCD00335F2C82D35E0CC0339A22A4105B6558';\r\n\r\nexport default function Login() {\r\n    const [account, setAccount] = useState('');\r\n    const [password, setPassword] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const navigate = useNavigate();\r\n    const setAuth = useAuthStore((s) => s.setAuth);\r\n\r\n    const handleSubmit = async (e: FormEvent) => {\r\n        e.preventDefault();\r\n        setLoading(true);\r\n        setError(null);\r\n\r\n        try {\r\n            const res: any = await gimiService.login(account, password);\r\n            if (res?.result) {\r\n                setAuth({\r\n                    accessToken: res.result.accessToken,\r\n                    refreshToken: res.result.refreshToken,\r\n                    expiresIn: res.result.expiresIn,\r\n                    userId: account,\r\n                    appKey: APP_KEY,\r\n                });\r\n                navigate('/');\r\n            }\r\n        } catch (err: any) {\r\n            setError(err.message || 'Login failed');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div style={{\r\n            height: '100vh',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            background: 'var(--bg-primary)',\r\n            position: 'relative',\r\n            overflow: 'hidden',\r\n        }}>\r\n            {/* Animated background blobs */}\r\n            <div style={{\r\n                position: 'absolute',\r\n                inset: 0,\r\n                overflow: 'hidden',\r\n                pointerEvents: 'none',\r\n            }}>\r\n                <div style={{\r\n                    position: 'absolute',\r\n                    width: '500px',\r\n                    height: '500px',\r\n                    borderRadius: '50%',\r\n                    background: 'radial-gradient(circle, rgba(0,212,170,0.08) 0%, transparent 70%)',\r\n                    top: '-100px',\r\n                    right: '-100px',\r\n                    animation: 'float-blob 20s ease-in-out infinite',\r\n                }} />\r\n                <div style={{\r\n                    position: 'absolute',\r\n                    width: '400px',\r\n                    height: '400px',\r\n                    borderRadius: '50%',\r\n                    background: 'radial-gradient(circle, rgba(0,184,148,0.06) 0%, transparent 70%)',\r\n                    bottom: '-80px',\r\n                    left: '-80px',\r\n                    animation: 'float-blob 25s ease-in-out infinite reverse',\r\n                }} />\r\n                <div style={{\r\n                    position: 'absolute',\r\n                    width: '300px',\r\n                    height: '300px',\r\n                    borderRadius: '50%',\r\n                    background: 'radial-gradient(circle, rgba(0,212,170,0.04) 0%, transparent 70%)',\r\n                    top: '40%',\r\n                    left: '50%',\r\n                    animation: 'float-blob 18s ease-in-out infinite',\r\n                }} />\r\n            </div>\r\n\r\n            {/* Login Card */}\r\n            <form\r\n                onSubmit={handleSubmit}\r\n                className=\"glass-panel animate-slide-up\"\r\n                style={{\r\n                    width: '100%',\r\n                    maxWidth: '420px',\r\n                    padding: '40px 36px',\r\n                    position: 'relative',\r\n                    zIndex: 1,\r\n                }}\r\n            >\r\n                {/* Logo */}\r\n                <div style={{ textAlign: 'center', marginBottom: '32px' }}>\r\n                    <div style={{\r\n                        width: 56,\r\n                        height: 56,\r\n                        borderRadius: '16px',\r\n                        background: 'linear-gradient(135deg, var(--accent), #00b894)',\r\n                        display: 'inline-flex',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'center',\r\n                        marginBottom: '16px',\r\n                        boxShadow: 'var(--accent-glow)',\r\n                    }}>\r\n                        <svg width=\"28\" height=\"28\" viewBox=\"0 0 24 24\" fill=\"#0a0e1a\" stroke=\"none\">\r\n                            <path d=\"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z\" />\r\n                        </svg>\r\n                    </div>\r\n                    <h1 style={{\r\n                        fontSize: '24px',\r\n                        fontWeight: 700,\r\n                        letterSpacing: '-0.03em',\r\n                        marginBottom: '4px',\r\n                    }}>\r\n                        Saudi<span style={{ color: 'var(--accent)' }}>Ex</span>\r\n                    </h1>\r\n                    <p style={{ color: 'var(--text-muted)', fontSize: '13px' }}>\r\n                        Fleet Tracking Platform\r\n                    </p>\r\n                </div>\r\n\r\n                {/* Error */}\r\n                {error && (\r\n                    <div style={{\r\n                        padding: '10px 14px',\r\n                        borderRadius: 'var(--radius-md)',\r\n                        background: 'rgba(239,68,68,0.1)',\r\n                        border: '1px solid rgba(239,68,68,0.2)',\r\n                        color: 'var(--danger)',\r\n                        fontSize: '13px',\r\n                        marginBottom: '20px',\r\n                    }}>\r\n                        {error}\r\n                    </div>\r\n                )}\r\n\r\n                {/* Inputs */}\r\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '16px', marginBottom: '24px' }}>\r\n                    <div>\r\n                        <label style={{ display: 'block', fontSize: '12px', fontWeight: 500, color: 'var(--text-secondary)', marginBottom: '6px', textTransform: 'uppercase', letterSpacing: '0.05em' }}>\r\n                            Account ID\r\n                        </label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={account}\r\n                            onChange={(e) => setAccount(e.target.value)}\r\n                            className=\"sx-input\"\r\n                            placeholder=\"Enter your account ID\"\r\n                            required\r\n                        />\r\n                    </div>\r\n                    <div>\r\n                        <label style={{ display: 'block', fontSize: '12px', fontWeight: 500, color: 'var(--text-secondary)', marginBottom: '6px', textTransform: 'uppercase', letterSpacing: '0.05em' }}>\r\n                            Password (MD5)\r\n                        </label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={password}\r\n                            onChange={(e) => setPassword(e.target.value)}\r\n                            className=\"sx-input\"\r\n                            placeholder=\"MD5 hashed password\"\r\n                            required\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Submit */}\r\n                <button\r\n                    type=\"submit\"\r\n                    disabled={loading}\r\n                    className=\"sx-btn sx-btn-primary\"\r\n                    style={{ width: '100%', padding: '12px', fontSize: '15px' }}\r\n                >\r\n                    {loading ? (\r\n                        <span style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                            <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" style={{ animation: 'spin 1s linear infinite' }}>\r\n                                <circle cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"3\" fill=\"none\" strokeDasharray=\"31.4\" strokeLinecap=\"round\" />\r\n                            </svg>\r\n                            Signing in...\r\n                        </span>\r\n                    ) : 'Sign In'}\r\n                </button>\r\n\r\n                {/* Footer */}\r\n                <p style={{ textAlign: 'center', color: 'var(--text-muted)', fontSize: '11px', marginTop: '24px' }}>\r\n                    Powered by TrackSolid Pro\r\n                </p>\r\n            </form>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aamer\\Desktop\\SaudiEx project agents\\gimi integrartion\\gimi-tracking-app\\src\\services\\api.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[675,678],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[675,678],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1519,1522],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1519,1522],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import axios from 'axios';\r\nimport MD5 from 'crypto-js/md5';\r\n\r\n// TrackSolid Pro Open API (EU node)\r\n// Proxied through Vite dev server to bypass CORS\r\n// See vite.config.ts: /api -> https://eu-open.tracksolidpro.com/route/rest\r\nconst BASE_URL = '/api';\r\n\r\n// App Credentials from Documentation\r\nconst APP_KEY = '8FB345B8693CCD00335F2C82D35E0CC0339A22A4105B6558';\r\nconst APP_SECRET = 'd1bf0654370a4a148abacd02abe8146e';\r\n\r\nexport const api = axios.create({\r\n    baseURL: BASE_URL,\r\n    timeout: 15000,\r\n});\r\n\r\n// Helper to generate signature\r\n// Sign = MD5(app_secret + sorted(key+value) + app_secret).toUpperCase()\r\nexport const generateSignature = (params: Record<string, any>): string => {\r\n    const sortedKeys = Object.keys(params).sort();\r\n\r\n    let paramString = APP_SECRET;\r\n    for (const key of sortedKeys) {\r\n        if (key === 'sign') continue;\r\n        paramString += `${key}${params[key]}`;\r\n    }\r\n    paramString += APP_SECRET;\r\n\r\n    return MD5(paramString).toString().toUpperCase();\r\n};\r\n\r\n// Request Interceptor to add common params and signature\r\napi.interceptors.request.use((config) => {\r\n    const pad = (n: number) => n < 10 ? `0${n}` : n;\r\n    const now = new Date();\r\n    // CRITICAL: GIMI/TrackSolid Pro requires UTC timestamp (GMT+0)\r\n    const timestamp = `${now.getUTCFullYear()}-${pad(now.getUTCMonth() + 1)}-${pad(now.getUTCDate())} ${pad(now.getUTCHours())}:${pad(now.getUTCMinutes())}:${pad(now.getUTCSeconds())}`;\r\n\r\n    // Common parameters\r\n    const commonParams: Record<string, any> = {\r\n        app_key: APP_KEY,\r\n        format: 'json',\r\n        sign_method: 'md5',\r\n        timestamp: timestamp,\r\n        v: '1.0',\r\n    };\r\n\r\n    // The Gimi API sends everything as query params for both GET and POST\r\n    // We merge common params + the data object passed via api.post('', { ... })\r\n    const privateParams = config.data || config.params || {};\r\n    const allParams = { ...commonParams, ...privateParams };\r\n\r\n    // Generate signature\r\n    const sign = generateSignature(allParams);\r\n    allParams.sign = sign;\r\n\r\n    // Send everything as query params (Gimi IoT API pattern)\r\n    config.params = allParams;\r\n    config.data = undefined; // Clear body ΓÇö everything goes in URL\r\n\r\n    return config;\r\n});\r\n\r\n// Response Interceptor\r\napi.interceptors.response.use(\r\n    (response) => {\r\n        const data = response.data;\r\n\r\n        // Debug: Log every response\r\n        console.log('[GIMI API Response]', data);\r\n\r\n        // Gimi returns { code: 0, message: 'success', result: {...} } on success\r\n        // On error: { code: <number>, message: 'error message' }\r\n        if (data.code !== undefined && data.code !== 0) {\r\n            return Promise.reject(new Error(data.message || `API Error (code: ${data.code})`));\r\n        }\r\n\r\n        return data;\r\n    },\r\n    (error) => {\r\n        console.error('[GIMI API Error]', error);\r\n        return Promise.reject(error);\r\n    }\r\n);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aamer\\Desktop\\SaudiEx project agents\\gimi integrartion\\gimi-tracking-app\\src\\services\\gimi.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aamer\\Desktop\\SaudiEx project agents\\gimi integrartion\\gimi-tracking-app\\src\\store\\auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\aamer\\Desktop\\SaudiEx project agents\\gimi integrartion\\gimi-tracking-app\\src\\store\\devices.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
